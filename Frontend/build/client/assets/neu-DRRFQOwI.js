import{w as k,r as a}from"./chunk-FGUA77HG-DXx5pbNv.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{f as i}from"./fetchApi-CVhRWstt.js";import{u as C}from"./useTranslation-DlJuNdwr.js";import"./config-Diokydjp.js";const F=k(function(){const{t:s}=C(),[o,l]=a.useState(""),[c,d]=a.useState(""),[b,w]=a.useState([]),[m,u]=a.useState(!1),[p,f]=a.useState(null),[h,x]=a.useState(null),[j,r]=a.useState(0),g=a.useRef(null);a.useEffect(()=>{i("/kunden").then(t=>{const n=t.data||t||[];w(Array.isArray(n)?n:[])}).catch(()=>{})},[]),a.useEffect(()=>{i("/arbeitszeiten/timer/running").then(t=>{if(t&&t.data){const n=new Date(t.data.start).getTime();f(t.data.id),x(n),r(Math.floor((Date.now()-n)/1e3)),u(!0),t.data.aufgaben&&l(t.data.aufgaben),t.data.kunde_id&&d(String(t.data.kunde_id))}}).catch(()=>{})},[]),a.useEffect(()=>(m&&h&&(g.current=setInterval(()=>{r(Math.floor((Date.now()-h)/1e3))},1e3)),()=>{g.current&&clearInterval(g.current)}),[m,h]);const y=t=>{const n=Math.floor(t/3600),T=Math.floor(t%3600/60),N=t%60;return`${String(n).padStart(2,"0")}:${String(T).padStart(2,"0")}:${String(N).padStart(2,"0")}`},S=async()=>{try{const t=await i("/arbeitszeiten/timer/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({kunde_id:c?parseInt(c):null,aufgaben:o})}),n=new Date(t.data.start).getTime();f(t.data.id),x(n),r(0),u(!0)}catch(t){console.error("Timer Start Fehler:",t),alert("Timer konnte nicht gestartet werden.")}},v=async()=>{if(p)try{await i(`/arbeitszeiten/timer/${p}/stop`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({aufgaben:o})}),u(!1),f(null),x(null),r(0),l(""),d(""),window.location.href="/"}catch(t){console.error("Timer Stop Fehler:",t),alert("Timer konnte nicht gestoppt werden.")}};return e.jsxs("div",{className:"flex min-h-full flex-col justify-center px-6 py-12 lg:px-8",children:[e.jsx("div",{className:"sm:mx-auto sm:w-full sm:max-w-sm",children:e.jsx("h2",{className:"mt-10 text-center text-2xl/9 font-bold tracking-tight text-white",children:s("newWorkTime")})}),e.jsxs("div",{className:"mt-10 sm:mx-auto sm:w-full sm:max-w-sm space-y-6",children:[e.jsxs("div",{className:"rounded-lg bg-white/5 p-6 text-center",children:[e.jsx("div",{className:"text-5xl font-mono font-bold text-white mb-6",children:y(j)}),m?e.jsx("button",{type:"button",onClick:v,className:"rounded-md bg-red-600 px-6 py-2 text-sm font-semibold text-white hover:bg-red-500",children:"Timer stoppen"}):e.jsx("button",{type:"button",onClick:S,className:"rounded-md bg-green-600 px-6 py-2 text-sm font-semibold text-white hover:bg-green-500",children:"Timer starten"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"aufgaben",className:"block text-sm/6 font-medium text-gray-100",children:s("tasks")}),e.jsx("div",{className:"mt-2",children:e.jsx("textarea",{id:"aufgaben",name:"aufgaben",value:o,onChange:t=>l(t.target.value),rows:4,className:"block w-full rounded-md bg-white/5 px-3 py-1.5 text-base text-white outline-1 -outline-offset-1 outline-white/10 placeholder:text-gray-500 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-500 sm:text-sm/6"})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"kunde",className:"block text-sm/6 font-medium text-gray-100",children:s("customer")}),e.jsx("div",{className:"mt-2",children:e.jsxs("select",{id:"kunde",name:"kunde",value:c,onChange:t=>d(t.target.value),className:"block w-full rounded-md bg-white/5 px-3 py-1.5 text-base text-white outline-1 -outline-offset-1 outline-white/10 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-500 sm:text-sm/6",children:[e.jsx("option",{value:"",children:"Kunde auswÃ¤hlen..."}),b.map(t=>e.jsx("option",{value:String(t.id),children:t.firmenname},t.id))]})})]}),e.jsx("p",{className:"mt-4 text-center text-sm/6 text-gray-400",children:e.jsx("a",{href:"/",className:"font-semibold text-indigo-400 hover:text-indigo-300",children:s("backToDashboard")})})]})]})});export{F as default};
